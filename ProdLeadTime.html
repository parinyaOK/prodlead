<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>เครื่องคำนวณเวลาการผลิต TSPT1</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .lang { display: none; }
        .lang.active { display: inline; }
        .lang-btn.active-lang { font-weight: bold; }
        #status { font-weight: bold; margin-bottom: 10px; }
        .hidden { display: none; }
        .checkbox-group { margin-top: 5px; }
        #errorMessage { color: red; margin-top: 10px; }
        #footer { position: fixed; bottom: 10px; right: 10px; color: #ccc; font-size: 12px; }
    </style>
</head>
<body class="bg-gray-100 p-4">
    <div class="max-w-4xl mx-auto">
        <div class="flex justify-between mb-4">
            <h1 class="text-2xl font-bold">
                <span class="lang lang-th active">เครื่องคำนวณเวลาการผลิต TSPT1</span>
                <span class="lang lang-en">TSPT1 Production Time Calculator</span>
            </h1>
            <div>
                <button id="lang-th" class="lang-btn active-lang px-2">TH</button>
                <button id="lang-en" class="lang-btn px-2">EN</button>
            </div>
        </div>

        <!-- Input Form -->
        <div class="bg-white p-6 rounded shadow-md mb-6">
            <div id="status" class="text-gray-700">
                <span class="lang lang-th active">พร้อมคำนวณ</span>
                <span class="lang lang-en">Ready to calculate</span>
            </div>
            <div id="errorMessage" class="hidden"></div>
            <div class="mb-4">
                <label class="mr-2">
                    <span class="lang lang-th active">อยากรู้เรื่องอะไร?</span>
                    <span class="lang lang-en">What do you want to find?</span>
                </label>
                <select id="calcMode" class="p-2 border rounded">
                    <option value="time" class="lang lang-th active">เวลาที่เสร็จ</option>
                    <option value="time" class="lang lang-en">Completion Time</option>
                    <option value="output" class="lang lang-th active">จำนวนชิ้นที่ทำได้</option>
                    <option value="output" class="lang lang-en">How Many Pieces</option>
                </select>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block">
                        <span class="lang lang-th active">เวลาเริ่ม</span>
                        <span class="lang lang-en">Start Time</span>
                    </label>
                    <input type="datetime-local" id="startTime" class="w-full p-2 border rounded">
                </div>
                <div id="targetOutputDiv">
                    <label class="block">
                        <span class="lang lang-th active">จำนวนชิ้นที่ต้องการ</span>
                        <span class="lang lang-en">Target Pieces</span>
                    </label>
                    <input type="text" id="targetOutput" class="w-full p-2 border rounded" onblur="calculateInput(this)">
                </div>
                <div id="fixedTimeDiv" class="hidden">
                    <label class="block">
                        <span class="lang lang-th active">เวลาที่ต้องเสร็จ</span>
                        <span class="lang lang-en">Finish Time</span>
                    </label>
                    <input type="datetime-local" id="fixedTime" class="w-full p-2 border rounded">
                </div>
                <div>
                    <label id="rateLabel" class="block">
                        <span class="lang lang-th active">เวลาไซเคิล (วินาที/ชิ้น)</span>
                        <span class="lang lang-en">Cycle Time (sec/piece)</span>
                    </label>
                    <select id="rateType" class="p-2 border rounded mb-2" onchange="toggleRateType(this)">
                        <option value="cycleTime" class="lang lang-th active">เวลาไซเคิล (วินาที/ชิ้น)</option>
                        <option value="cycleTime" class="lang lang-en">Cycle Time (sec/piece)</option>
                        <option value="piecesPerHour" class="lang lang-th active">ชิ้นต่อชั่วโมง</option>
                        <option value="piecesPerHour" class="lang lang-en">Pieces per Hour</option>
                    </select>
                    <input type="text" id="cycleTime" class="w-full p-2 border rounded" onblur="calculateInput(this)">
                </div>
                <div>
                    <label class="block">
                        <span class="lang lang-th active">เวลาเตรียม (นาที)</span>
                        <span class="lang lang-en">Setup Time (min)</span>
                    </label>
                    <input type="text" id="setupTime" class="w-full p-2 border rounded" onblur="calculateInput(this)">
                </div>
                <div>
                    <label class="block">
                        <span class="lang lang-th active">เวลาพัก</span>
                        <span class="lang lang-en">Break Times</span>
                    </label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="breakTime" value="10:00-10:10"> 10:00 - 10:10 (10 min)</label><br>
                        <label><input type="checkbox" name="breakTime" value="12:00-12:50"> 12:00 - 12:50 (50 min)</label><br>
                        <label><input type="checkbox" name="breakTime" value="15:00-15:10"> 15:00 - 15:10 (10 min)</label><br>
                        <label><input type="checkbox" name="breakTime" value="17:00-17:30"> 17:00 - 17:30 (30 min)</label><br>
                        <label><input type="checkbox" name="breakTime" value="22:00-22:10"> 22:00 - 22:10 (10 min)</label><br>
                        <label><input type="checkbox" name="breakTime" value="00:00-01:00"> 00:00 - 01:00 (60 min)</label><br>
                        <label><input type="checkbox" name="breakTime" value="03:00-03:10"> 03:00 - 03:10 (10 min)</label><br>
                        <label><input type="checkbox" name="breakTime" value="05:00-05:10"> 05:00 - 05:10 (10 min)</label>
                    </div>
                </div>
                <div>
                    <label class="block">
                        <span class="lang lang-th active">ชื่อชิ้นงาน</span>
                        <span class="lang lang-en">Part Name</span>
                    </label>
                    <input type="text" id="partName" class="w-full p-2 border rounded" placeholder="e.g., Cover">
                </div>
                <div>
                    <label class="block">
                        <span class="lang lang-th active">ของเสียตอนเริ่ม</span>
                        <span class="lang lang-en">Start Defect</span>
                    </label>
                    <select id="startupDefectUnit" class="p-2 border rounded mb-2" onchange="toggleDefectUnit('startupDefectUnit')">
                        <option value="percent" class="lang lang-th active">%</option>
                        <option value="percent" class="lang lang-en">%</option>
                        <option value="pieces" class="lang lang-th active">ชิ้น</option>
                        <option value="pieces" class="lang lang-en">Pieces</option>
                    </select>
                    <input type="text" id="startupDefect" class="w-full p-2 border rounded" onblur="calculateInput(this)">
                </div>
                <div>
                    <label class="block">
                        <span class="lang lang-th active">ของเสียระหว่างทำ</span>
                        <span class="lang lang-en">Process Defect</span>
                    </label>
                    <select id="scrapRateUnit" class="p-2 border rounded mb-2" onchange="toggleDefectUnit('scrapRateUnit')">
                        <option value="percent" class="lang lang-th active">%</option>
                        <option value="percent" class="lang lang-en">%</option>
                        <option value="pieces" class="lang lang-th active">ชิ้น</option>
                        <option value="pieces" class="lang lang-en">Pieces</option>
                    </select>
                    <input type="text" id="scrapRate" class="w-full p-2 border rounded" onblur="calculateInput(this)">
                </div>
                <button id="calculateBtn" class="col-span-full bg-blue-500 text-white p-2 rounded">
                    <span class="lang lang-th active">คำนวณ</span>
                    <span class="lang lang-en">Calculate</span>
                </button>
            </div>
            <button id="deleteJob" class="mt-2 bg-red-500 text-white p-2 rounded w-full">
                <span class="lang lang-th active">ลบงาน</span>
                <span class="lang lang-en">Delete Job</span>
            </button>
        </div>

        <!-- Results -->
        <div id="results" class="hidden">
            <div class="bg-white p-6 rounded shadow-md mb-6">
                <h2 class="text-xl font-bold mb-4">
                    <span class="lang lang-th active">ผลการผลิต</span>
                    <span class="lang lang-en">Production Result</span>
                </h2>
                <table class="w-full text-left mb-4" id="resultTable"></table>
                <div class="text-lg font-semibold" id="completionTimeDiv">
                    <span class="lang lang-th active">เวลาที่เสร็จ: </span>
                    <span class="lang lang-en">Finish Time: </span>
                    <span id="completionTime"></span>
                </div>
                <div class="text-lg font-semibold hidden" id="outputResultDiv">
                    <span class="lang lang-th active">จำนวนชิ้นที่ทำได้: </span>
                    <span class="lang lang-en">Pieces Possible: </span>
                    <span id="outputResult"></span>
                </div>
            </div>

            <div class="bg-white p-6 rounded shadow-md mb-6">
                <h2 class="text-xl font-bold mb-4">
                    <span class="lang lang-th active">สูตรและวิธีคำนวณ</span>
                    <span class="lang lang-en">Formula and Calculation Steps</span>
                </h2>
                <div id="calculationSteps"></div>
            </div>

            <div class="bg-white p-6 rounded shadow-md mb-6">
                <h2 class="text-xl font-bold mb-4">
                    <span class="lang lang-th active">วิธีทำให้ดีขึ้นแบบละเอียด</span>
                    <span class="lang lang-en">Detailed Tips to Improve</span>
                </h2>
                <div id="suggestions"></div>
            </div>
        </div>
    </div>
    <div id="footer">chaiyapat.cha</div>

    <script>
        let currentLang = 'th';

        // Language Toggle
        document.getElementById('lang-th').addEventListener('click', () => switchLang('th'));
        document.getElementById('lang-en').addEventListener('click', () => switchLang('en'));

        function switchLang(lang) {
            currentLang = lang;
            document.querySelectorAll('.lang').forEach(el => el.classList.remove('active'));
            document.querySelectorAll(`.lang-${lang}`).forEach(el => el.classList.add('active'));
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active-lang'));
            document.getElementById(`lang-${lang}`).classList.add('active-lang');
            updateStatus('ready');
            updateSelectOptions();
            if (!document.getElementById('results').classList.contains('hidden')) {
                calculateLeadTime();
            }
        }

        // Update Select Options
        function updateSelectOptions() {
            const calcMode = document.getElementById('calcMode');
            const rateType = document.getElementById('rateType');
            const startupDefectUnit = document.getElementById('startupDefectUnit');
            const scrapRateUnit = document.getElementById('scrapRateUnit');

            calcMode.innerHTML = `
                <option value="time">${currentLang === 'th' ? 'เวลาที่เสร็จ' : 'Completion Time'}</option>
                <option value="output">${currentLang === 'th' ? 'จำนวนชิ้นที่ทำได้' : 'How Many Pieces'}</option>
            `;
            rateType.innerHTML = `
                <option value="cycleTime">${currentLang === 'th' ? 'เวลาไซเคิล (วินาที/ชิ้น)' : 'Cycle Time (sec/piece)'}</option>
                <option value="piecesPerHour">${currentLang === 'th' ? 'ชิ้นต่อชั่วโมง' : 'Pieces per Hour'}</option>
            `;
            startupDefectUnit.innerHTML = `
                <option value="percent">${currentLang === 'th' ? '%' : '%'}</option>
                <option value="pieces">${currentLang === 'th' ? 'ชิ้น' : 'Pieces'}</option>
            `;
            scrapRateUnit.innerHTML = `
                <option value="percent">${currentLang === 'th' ? '%' : '%'}</option>
                <option value="pieces">${currentLang === 'th' ? 'ชิ้น' : 'Pieces'}</option>
            `;
        }

        // Status Update
        function updateStatus(state, errorMsg = '') {
            const status = document.getElementById('status');
            const errorDiv = document.getElementById('errorMessage');
            const messages = {
                ready: { th: 'พร้อมคำนวณ', en: 'Ready to calculate' },
                calculating: { th: 'กำลังคำนวณ...', en: 'Calculating...' },
                done: { th: 'เสร็จแล้ว!', en: 'Done!' },
                error: { th: 'ผิดพลาด!', en: 'Error!' }
            };
            status.innerHTML = `
                <span class="lang lang-th ${currentLang === 'th' ? 'active' : ''}">${messages[state].th}</span>
                <span class="lang lang-en ${currentLang === 'en' ? 'active' : ''}">${messages[state].en}</span>
            `;
            status.className = `text-${state === 'done' ? 'green' : state === 'error' ? 'red' : 'gray'}-700`;
            if (errorMsg) {
                errorDiv.textContent = errorMsg;
                errorDiv.classList.remove('hidden');
            } else {
                errorDiv.classList.add('hidden');
            }
        }

        // Mode Toggle
        document.getElementById('calcMode').addEventListener('change', (e) => {
            const mode = e.target.value;
            document.getElementById('targetOutputDiv').classList.toggle('hidden', mode === 'output');
            document.getElementById('fixedTimeDiv').classList.toggle('hidden', mode === 'time');
        });

        // Rate Type Toggle
        function toggleRateType(select) {
            const label = document.getElementById('rateLabel');
            label.innerHTML = `
                <span class="lang lang-th ${currentLang === 'th' ? 'active' : ''}">${select.value === 'cycleTime' ? 'เวลาไซเคิล (วินาที/ชิ้น)' : 'ชิ้นต่อชั่วโมง'}</span>
                <span class="lang lang-en ${currentLang === 'en' ? 'active' : ''}">${select.value === 'cycleTime' ? 'Cycle Time (sec/piece)' : 'Pieces per Hour'}</span>
            `;
            document.getElementById('cycleTime').value = '';
        }

        // Defect Unit Toggle
        function toggleDefectUnit(id) {
            document.getElementById(id.replace('Unit', '')).value = '';
        }

        // Calculator Input
        function calculateInput(input) {
            let value = input.value.trim();
            if (/[\+\-\*\/]/.test(value)) {
                try {
                    const result = new Function(`return ${value}`)();
                    if (!isNaN(result) && result >= 0) {
                        input.value = result.toFixed(2);
                        input.style.borderColor = '';
                    } else {
                        throw new Error();
                    }
                } catch {
                    input.value = '';
                    input.style.borderColor = 'red';
                }
            } else {
                const num = parseFloat(value);
                if (isNaN(num) || num < 0) {
                    input.value = '';
                    input.style.borderColor = 'red';
                } else {
                    input.value = num.toFixed(2);
                    input.style.borderColor = '';
                }
            }
        }

        // Calculate Button
        document.getElementById('calculateBtn').addEventListener('click', () => {
            calculateLeadTime();
        });

        // Delete Job
        document.getElementById('deleteJob').addEventListener('click', () => {
            document.getElementById('results').classList.add('hidden');
            document.querySelectorAll('input').forEach(input => {
                input.value = '';
                input.style.borderColor = '';
            });
            updateStatus('ready');
        });

        function getBreakTimeMinutes(breakTimes, startTime, totalTimeMin) {
            const breakTimesMap = {
                "10:00-10:10": 10,
                "12:00-12:50": 50,
                "15:00-15:10": 10,
                "17:00-17:30": 30,
                "22:00-22:10": 10,
                "00:00-01:00": 60,
                "03:00-03:10": 10,
                "05:00-05:10": 10
            };
            let totalBreakMin = 0;
            const start = new Date(startTime);
            const end = new Date(start.getTime() + totalTimeMin * 60 * 1000);

            breakTimes.forEach(time => {
                const [startStr, endStr] = time.split('-');
                const breakStart = new Date(start);
                const breakEnd = new Date(start);

                breakStart.setHours(parseInt(startStr.split(':')[0]), parseInt(startStr.split(':')[1]), 0, 0);
                breakEnd.setHours(parseInt(endStr.split(':')[0]), parseInt(endStr.split(':')[1]), 0, 0);

                if (breakStart < end && breakEnd > start) {
                    totalBreakMin += breakTimesMap[time];
                }
            });
            return totalBreakMin;
        }

        function calculateLeadTime() {
            updateStatus('calculating');

            const mode = document.getElementById('calcMode').value;
            const startTime = document.getElementById('startTime').value;
            const rateType = document.getElementById('rateType').value;
            const cycleTimeInput = document.getElementById('cycleTime').value;
            const setupTimeMin = parseFloat(document.getElementById('setupTime').value) || 0;
            const breakTimes = Array.from(document.querySelectorAll('input[name="breakTime"]:checked')).map(cb => cb.value);
            const partName = document.getElementById('partName').value || (currentLang === 'th' ? 'ชิ้นงานไม่มีชื่อ' : 'Unnamed Part');
            const startupDefectUnit = document.getElementById('startupDefectUnit').value;
            const scrapRateUnit = document.getElementById('scrapRateUnit').value;
            let startupDefect = parseFloat(document.getElementById('startupDefect').value) || 0;
            let scrapRate = parseFloat(document.getElementById('scrapRate').value) || 0;

            if (!startTime) {
                updateStatus('error', currentLang === 'th' ? 'กรุณากรอกเวลาเริ่ม!' : 'Please enter Start Time!');
                return;
            }
            if (!cycleTimeInput) {
                updateStatus('error', currentLang === 'th' ? 'กรุณากรอกเวลาไซเคิล!' : 'Please enter Cycle Time!');
                return;
            }

            let cycleTime = parseFloat(cycleTimeInput);
            if (isNaN(cycleTime) || cycleTime <= 0) {
                updateStatus('error', currentLang === 'th' ? 'เวลาไซเคิลต้องเป็นตัวเลขบวก!' : 'Cycle Time must be a positive number!');
                return;
            }
            if (rateType === 'piecesPerHour') {
                cycleTime = 3600 / cycleTime;
            }

            const setupTime = setupTimeMin * 60;

            let totalParts, totalCycleTime, totalTime, completionTime, targetOutput;
            let calcSteps = [];

            if (mode === 'time') {
                targetOutput = parseFloat(document.getElementById('targetOutput').value);
                if (isNaN(targetOutput) || targetOutput <= 0) {
                    updateStatus('error', currentLang === 'th' ? 'กรุณากรอกจำนวนชิ้นที่ต้องการให้ถูกต้อง!' : 'Please enter a valid Target Pieces!');
                    return;
                }

                let defectFactor = 1;
                if (startupDefectUnit === 'percent') startupDefect /= 100;
                if (scrapRateUnit === 'percent') scrapRate /= 100;

                if (startupDefectUnit === 'percent' && scrapRateUnit === 'percent') {
                    defectFactor = 1 + startupDefect + scrapRate;
                    calcSteps.push(currentLang === 'th' ? 
                        `1. คำนวณจำนวนชิ้นทั้งหมด (รวมของเสีย): ${targetOutput} × (1 + ${startupDefect * 100}% + ${scrapRate * 100}%) = ${targetOutput} × ${defectFactor} = ${Math.ceil(targetOutput * defectFactor)} ชิ้น` :
                        `1. Calculate Total Pieces (with defects): ${targetOutput} × (1 + ${startupDefect * 100}% + ${scrapRate * 100}%) = ${targetOutput} × ${defectFactor} = ${Math.ceil(targetOutput * defectFactor)} pcs`);
                } else if (startupDefectUnit === 'pieces' && scrapRateUnit === 'pieces') {
                    totalParts = targetOutput + startupDefect + scrapRate;
                    calcSteps.push(currentLang === 'th' ? 
                        `1. คำนวณจำนวนชิ้นทั้งหมด (รวมของเสีย): ${targetOutput} + ${startupDefect} + ${scrapRate} = ${totalParts} ชิ้น` :
                        `1. Calculate Total Pieces (with defects): ${targetOutput} + ${startupDefect} + ${scrapRate} = ${totalParts} pcs`);
                } else {
                    updateStatus('error', currentLang === 'th' ? 'หน่วยของเสียต้องเหมือนกัน (ทั้ง % หรือทั้งชิ้น)!' : 'Defect units must be the same (both % or both pieces)!');
                    return;
                }

                totalParts = startupDefectUnit === 'percent' ? Math.ceil(targetOutput * defectFactor) : totalParts;
                totalCycleTime = totalParts * cycleTime;
                calcSteps.push(currentLang === 'th' ? 
                    `2. คำนวณเวลาทำงาน: ${totalParts} × ${cycleTime} วินาที = ${totalCycleTime} วินาที (${(totalCycleTime / 60).toFixed(1)} นาที)` :
                    `2. Calculate Production Time: ${totalParts} × ${cycleTime} sec = ${totalCycleTime} sec (${(totalCycleTime / 60).toFixed(1)} min)`);

                const breakTimeMin = getBreakTimeMinutes(breakTimes, startTime, (totalCycleTime + setupTime) / 60);
                calcSteps.push(currentLang === 'th' ? 
                    `3. คำนวณเวลาพัก: ${breakTimes.length > 0 ? breakTimes.join(', ') + ' = ' + breakTimeMin : '0'} นาที` :
                    `3. Calculate Break Time: ${breakTimes.length > 0 ? breakTimes.join(', ') + ' = ' + breakTimeMin : '0'} min`);

                totalTime = totalCycleTime + setupTime + (breakTimeMin * 60);
                calcSteps.push(currentLang === 'th' ? 
                    `4. คำนวณเวลาทั้งหมด: ${totalCycleTime} + ${setupTime} + (${breakTimeMin} × 60) = ${totalTime} วินาที (${(totalTime / 60).toFixed(1)} นาที)` :
                    `4. Calculate Total Time: ${totalCycleTime} + ${setupTime} + (${breakTimeMin} × 60) = ${totalTime} sec (${(totalTime / 60).toFixed(1)} min)`);

                completionTime = new Date(new Date(startTime).getTime() + totalTime * 1000);
                calcSteps.push(currentLang === 'th' ? 
                    `5. คำนวณเวลาที่เสร็จ: ${new Date(startTime).toLocaleString('th-TH')} + ${(totalTime / 3600).toFixed(2)} ชั่วโมง = ${completionTime.toLocaleString('th-TH')}` :
                    `5. Calculate Finish Time: ${new Date(startTime).toLocaleString('en-US')} + ${(totalTime / 3600).toFixed(2)} hr = ${completionTime.toLocaleString('en-US')}`);

                document.getElementById('resultTable').innerHTML = `
                    <tr>
                        <td><span class="lang lang-th ${currentLang === 'th' ? 'active' : ''}">ชื่อชิ้นงาน:</span>
                            <span class="lang lang-en ${currentLang === 'en' ? 'active' : ''}">Part Name:</span></td>
                        <td>${partName}</td>
                    </tr>
                    <tr>
                        <td><span class="lang lang-th ${currentLang === 'th' ? 'active' : ''}">จำนวนชิ้นที่ต้องการ:</span>
                            <span class="lang lang-en ${currentLang === 'en' ? 'active' : ''}">Target Pieces:</span></td>
                        <td>${targetOutput} pcs</td>
                    </tr>
                    <tr>
                        <td><span class="lang lang-th ${currentLang === 'th' ? 'active' : ''}">ชิ้นทั้งหมด (รวมของเสีย):</span>
                            <span class="lang lang-en ${currentLang === 'en' ? 'active' : ''}">Total Pieces (with defects):</span></td>
                        <td>${totalParts} pcs</td>
                    </tr>
                    <tr>
                        <td><span class="lang lang-th ${currentLang === 'th' ? 'active' : ''}">เวลาทำงาน:</span>
                            <span class="lang lang-en ${currentLang === 'en' ? 'active' : ''}">Production Time:</span></td>
                        <td>${(totalCycleTime / 60).toFixed(1)} min (${(totalCycleTime / 3600).toFixed(2)} hr)</td>
                    </tr>
                    <tr>
                        <td><span class="lang lang-th ${currentLang === 'th' ? 'active' : ''}">เวลาเตรียม:</span>
                            <span class="lang lang-en ${currentLang === 'en' ? 'active' : ''}">Setup Time:</span></td>
                        <td>${(setupTime / 60).toFixed(1)} min (${(setupTime / 3600).toFixed(2)} hr)</td>
                    </tr>
                    <tr>
                        <td><span class="lang lang-th ${currentLang === 'th' ? 'active' : ''}">เวลาพัก:</span>
                            <span class="lang lang-en ${currentLang === 'en' ? 'active' : ''}">Break Time:</span></td>
                        <td>${breakTimeMin} min (${(breakTimeMin / 60).toFixed(2)} hr)</td>
                    </tr>
                    <tr>
                        <td><span class="lang lang-th ${currentLang === 'th' ? 'active' : ''}">เวลาทั้งหมด:</span>
                            <span class="lang lang-en ${currentLang === 'en' ? 'active' : ''}">Total Time:</span></td>
                        <td>${(totalTime / 60).toFixed(1)} min (${(totalTime / 3600).toFixed(2)} hr)</td>
                    </tr>
                `;
                document.getElementById('completionTime').textContent = completionTime.toLocaleString(currentLang === 'th' ? 'th-TH' : 'en-US');
                document.getElementById('completionTimeDiv').classList.remove('hidden');
                document.getElementById('outputResultDiv').classList.add('hidden');

                const suggestions = {
                    th: [
                        `<strong>1. ลดเวลาไซเคิล 20% (เหลือ ${(cycleTime * 0.8).toFixed(1)} วินาที):</strong><br>
                         - เวลาทำงานใหม่: ${(totalParts * cycleTime * 0.8 / 60).toFixed(1)} นาที<br>
                         - ประหยัดเวลา: ${(totalCycleTime * 0.2 / 60).toFixed(1)} นาที<br>
                         - เวลาทั้งหมดใหม่: ${((totalParts * cycleTime * 0.8 + setupTime + breakTimeMin * 60) / 60).toFixed(1)} นาที<br>
                         - เสร็จใหม่เวลา: ${new Date(new Date(startTime).getTime() + (totalParts * cycleTime * 0.8 + setupTime + breakTimeMin * 60) * 1000).toLocaleString('th-TH')}`,
                        `<strong>2. ลดเวลาเตรียม 30% (เหลือ ${(setupTime / 60 * 0.7).toFixed(1)} นาที):</strong><br>
                         - เวลาเตรียมใหม่: ${(setupTime * 0.7 / 60).toFixed(1)} นาที<br>
                         - ประหยัดเวลา: ${(setupTime * 0.3 / 60).toFixed(1)} นาที<br>
                         - เวลาทั้งหมดใหม่: ${((totalCycleTime + setupTime * 0.7 + breakTimeMin * 60) / 60).toFixed(1)} นาที<br>
                         - เสร็จใหม่เวลา: ${new Date(new Date(startTime).getTime() + (totalCycleTime + setupTime * 0.7 + breakTimeMin * 60) * 1000).toLocaleString('th-TH')}`,
                        `<strong>3. ลดของเสีย 50% (เหลือ ${(startupDefect * 50 + scrapRate * 50).toFixed(1)}${startupDefectUnit === 'percent' ? '%' : ' ชิ้น'}):</strong><br>
                         - ชิ้นทั้งหมดใหม่: ${Math.ceil(targetOutput * (1 + (startupDefectUnit === 'percent' ? startupDefect * 0.5 : startupDefect / targetOutput) + (scrapRateUnit === 'percent' ? scrapRate * 0.5 : scrapRate / targetOutput)))} ชิ้น<br>
                         - เวลาทำงานใหม่: ${(Math.ceil(targetOutput * (1 + (startupDefectUnit === 'percent' ? startupDefect * 0.5 : startupDefect / targetOutput) + (scrapRateUnit === 'percent' ? scrapRate * 0.5 : scrapRate / targetOutput))) * cycleTime / 60).toFixed(1)} นาที<br>
                         - ประหยัดเวลา: ${((totalParts - Math.ceil(targetOutput * (1 + (startupDefectUnit === 'percent' ? startupDefect * 0.5 : startupDefect / targetOutput) + (scrapRateUnit === 'percent' ? scrapRate * 0.5 : scrapRate / targetOutput))) * cycleTime) / 60).toFixed(1)} นาที<br>
                         - เวลาทั้งหมดใหม่: ${((Math.ceil(targetOutput * (1 + (startupDefectUnit === 'percent' ? startupDefect * 0.5 : startupDefect / targetOutput) + (scrapRateUnit === 'percent' ? scrapRate * 0.5 : scrapRate / targetOutput))) * cycleTime + setupTime + breakTimeMin * 60) / 60).toFixed(1)} นาที<br>
                         - เสร็จใหม่เวลา: ${new Date(new Date(startTime).getTime() + (Math.ceil(targetOutput * (1 + (startupDefectUnit === 'percent' ? startupDefect * 0.5 : startupDefect / targetOutput) + (scrapRateUnit === 'percent' ? scrapRate * 0.5 : scrapRate / targetOutput))) * cycleTime + setupTime + breakTimeMin * 60) * 1000).toLocaleString('th-TH')}`
                    ],
                    en: [
                        `<strong>1. Reduce Cycle Time by 20% (to ${(cycleTime * 0.8).toFixed(1)} sec):</strong><br>
                         - New Production Time: ${(totalParts * cycleTime * 0.8 / 60).toFixed(1)} min<br>
                         - Time Saved: ${(totalCycleTime * 0.2 / 60).toFixed(1)} min<br>
                         - New Total Time: ${((totalParts * cycleTime * 0.8 + setupTime + breakTimeMin * 60) / 60).toFixed(1)} min<br>
                         - New Finish Time: ${new Date(new Date(startTime).getTime() + (totalParts * cycleTime * 0.8 + setupTime + breakTimeMin * 60) * 1000).toLocaleString('en-US')}`,
                        `<strong>2. Reduce Setup Time by 30% (to ${(setupTime / 60 * 0.7).toFixed(1)} min):</strong><br>
                         - New Setup Time: ${(setupTime * 0.7 / 60).toFixed(1)} min<br>
                         - Time Saved: ${(setupTime * 0.3 / 60).toFixed(1)} min<br>
                         - New Total Time: ${((totalCycleTime + setupTime * 0.7 + breakTimeMin * 60) / 60).toFixed(1)} min<br>
                         - New Finish Time: ${new Date(new Date(startTime).getTime() + (totalCycleTime + setupTime * 0.7 + breakTimeMin * 60) * 1000).toLocaleString('en-US')}`,
                        `<strong>3. Reduce Defects by 50% (to ${(startupDefect * 50 + scrapRate * 50).toFixed(1)}${startupDefectUnit === 'percent' ? '%' : ' pcs'}):</strong><br>
                         - New Total Pieces: ${Math.ceil(targetOutput * (1 + (startupDefectUnit === 'percent' ? startupDefect * 0.5 : startupDefect / targetOutput) + (scrapRateUnit === 'percent' ? scrapRate * 0.5 : scrapRate / targetOutput)))} pcs<br>
                         - New Production Time: ${(Math.ceil(targetOutput * (1 + (startupDefectUnit === 'percent' ? startupDefect * 0.5 : startupDefect / targetOutput) + (scrapRateUnit === 'percent' ? scrapRate * 0.5 : scrapRate / targetOutput))) * cycleTime / 60).toFixed(1)} min<br>
                         - Time Saved: ${((totalParts - Math.ceil(targetOutput * (1 + (startupDefectUnit === 'percent' ? startupDefect * 0.5 : startupDefect / targetOutput) + (scrapRateUnit === 'percent' ? scrapRate * 0.5 : scrapRate / targetOutput))) * cycleTime) / 60).toFixed(1)} min<br>
                         - New Total Time: ${((Math.ceil(targetOutput * (1 + (startupDefectUnit === 'percent' ? startupDefect * 0.5 : startupDefect / targetOutput) + (scrapRateUnit === 'percent' ? scrapRate * 0.5 : scrapRate / targetOutput))) * cycleTime + setupTime + breakTimeMin * 60) / 60).toFixed(1)} min<br>
                         - New Finish Time: ${new Date(new Date(startTime).getTime() + (Math.ceil(targetOutput * (1 + (startupDefectUnit === 'percent' ? startupDefect * 0.5 : startupDefect / targetOutput) + (scrapRateUnit === 'percent' ? scrapRate * 0.5 : scrapRate / targetOutput))) * cycleTime + setupTime + breakTimeMin * 60) * 1000).toLocaleString('en-US')}`
                    ]
                };
                document.getElementById('suggestions').innerHTML = suggestions[currentLang].map(s => `<p>${s}</p>`).join('');
            } else {
                const fixedTime = document.getElementById('fixedTime').value;
                if (!fixedTime) {
                    updateStatus('error', currentLang === 'th' ? 'กรุณากรอกเวลาที่ต้องเสร็จ!' : 'Please enter Finish Time!');
                    return;
                }
                const availableTime = (new Date(fixedTime) - new Date(startTime)) / 1000;
                if (availableTime <= 0) {
                    updateStatus('error', currentLang === 'th' ? 'เวลาที่ต้องเสร็จต้องอยู่หลังเวลาเริ่ม!' : 'Finish Time must be after Start Time!');
                    return;
                }
                totalTime = availableTime;
                calcSteps.push(currentLang === 'th' ? 
                    `1. คำนวณเวลาที่ใช้ได้: (${new Date(fixedTime).toLocaleString('th-TH')} - ${new Date(startTime).toLocaleString('th-TH')}) = ${(totalTime / 60).toFixed(1)} นาที` :
                    `1. Calculate Available Time: (${new Date(fixedTime).toLocaleString('en-US')} - ${new Date(startTime).toLocaleString('en-US')}) = ${(totalTime / 60).toFixed(1)} min`);

                const breakTimeMin = getBreakTimeMinutes(breakTimes, startTime, totalTime / 60);
                calcSteps.push(currentLang === 'th' ? 
                    `2. คำนวณเวลาพัก: ${breakTimes.length > 0 ? breakTimes.join(', ') + ' = ' + breakTimeMin : '0'} นาที` :
                    `2. Calculate Break Time: ${breakTimes.length > 0 ? breakTimes.join(', ') + ' = ' + breakTimeMin : '0'} min`);

                totalCycleTime = totalTime - setupTime - (breakTimeMin * 60);
                calcSteps.push(currentLang === 'th' ? 
                    `3. คำนวณเวลาทำงาน: ${totalTime} - ${setupTime} - (${breakTimeMin} × 60) = ${totalCycleTime} วินาที (${(totalCycleTime / 60).toFixed(1)} นาที)` :
                    `3. Calculate Production Time: ${totalTime} - ${setupTime} - (${breakTimeMin} × 60) = ${totalCycleTime} sec (${(totalCycleTime / 60).toFixed(1)} min)`);

                if (totalCycleTime <= 0) {
                    updateStatus('error', currentLang === 'th' ? 'เวลาไม่พอหลังเตรียมและพัก!' : 'Not enough time after setup and breaks!');
                    return;
                }
                totalParts = Math.floor(totalCycleTime / cycleTime);
                calcSteps.push(currentLang === 'th' ? 
                    `4. คำนวณชิ้นทั้งหมด (รวมของเสีย): ${totalCycleTime} ÷ ${cycleTime} = ${totalParts} ชิ้น` :
                    `4. Calculate Total Pieces (with defects): ${totalCycleTime} ÷ ${cycleTime} = ${totalParts} pcs`);

                if (startupDefectUnit === 'percent') startupDefect /= 100;
                if (scrapRateUnit === 'percent') scrapRate /= 100;
                if (startupDefectUnit === 'percent' && scrapRateUnit === 'percent') {
                    targetOutput = Math.floor(totalParts / (1 + startupDefect + scrapRate));
                    calcSteps.push(currentLang === 'th' ? 
                        `5. คำนวณจำนวนชิ้นที่ทำได้: ${totalParts} ÷ (1 + ${startupDefect * 100}% + ${scrapRate * 100}%) = ${targetOutput} ชิ้น` :
                        `5. Calculate Pieces Possible: ${totalParts} ÷ (1 + ${startupDefect * 100}% + ${scrapRate * 100}%) = ${targetOutput} pcs`);
                } else if (startupDefectUnit === 'pieces' && scrapRateUnit === 'pieces') {
                    targetOutput = totalParts - startupDefect - scrapRate;
                    calcSteps.push(currentLang === 'th' ? 
                        `5. คำนวณจำนวนชิ้นที่ทำได้: ${totalParts} - ${startupDefect} - ${scrapRate} = ${targetOutput} ชิ้น` :
                        `5. Calculate Pieces Possible: ${totalParts} - ${startupDefect} - ${scrapRate} = ${targetOutput} pcs`);
                } else {
                    updateStatus('error', currentLang === 'th' ? 'หน่วยของเสียต้องเหมือนกัน (ทั้ง % หรือทั้งชิ้น)!' : 'Defect units must be the same (both % or both pieces)!');
                    return;
                }

                document.getElementById('resultTable').innerHTML = `
                    <tr>
                        <td><span class="lang lang-th ${currentLang === 'th' ? 'active' : ''}">ชื่อชิ้นงาน:</span>
                            <span class="lang lang-en ${currentLang === 'en' ? 'active' : ''}">Part Name:</span></td>
                        <td>${partName}</td>
                    </tr>
                    <tr>
                        <td><span class="lang lang-th ${currentLang === 'th' ? 'active' : ''}">ชิ้นทั้งหมด (รวมของเสีย):</span>
                            <span class="lang lang-en ${currentLang === 'en' ? 'active' : ''}">Total Pieces (with defects):</span></td>
                        <td>${totalParts} pcs</td>
                    </tr>
                    <tr>
                        <td><span class="lang lang-th ${currentLang === 'th' ? 'active' : ''}">เวลาทำงาน:</span>
                            <span class="lang lang-en ${currentLang === 'en' ? 'active' : ''}">Production Time:</span></td>
                        <td>${(totalCycleTime / 60).toFixed(1)} min (${(totalCycleTime / 3600).toFixed(2)} hr)</td>
                    </tr>
                    <tr>
                        <td><span class="lang lang-th ${currentLang === 'th' ? 'active' : ''}">เวลาเตรียม:</span>
                            <span class="lang lang-en ${currentLang === 'en' ? 'active' : ''}">Setup Time:</span></td>
                        <td>${(setupTime / 60).toFixed(1)} min (${(setupTime / 3600).toFixed(2)} hr)</td>
                    </tr>
                    <tr>
                        <td><span class="lang lang-th ${currentLang === 'th' ? 'active' : ''}">เวลาพัก:</span>
                            <span class="lang lang-en ${currentLang === 'en' ? 'active' : ''}">Break Time:</span></td>
                        <td>${breakTimeMin} min (${(breakTimeMin / 60).toFixed(2)} hr)</td>
                    </tr>
                    <tr>
                        <td><span class="lang lang-th ${currentLang === 'th' ? 'active' : ''}">เวลาทั้งหมด:</span>
                            <span class="lang lang-en ${currentLang === 'en' ? 'active' : ''}">Total Time:</span></td>
                        <td>${(totalTime / 60).toFixed(1)} min (${(totalTime / 3600).toFixed(2)} hr)</td>
                    </tr>
                `;
                document.getElementById('outputResult').textContent = `${targetOutput} pcs`;
                document.getElementById('completionTimeDiv').classList.add('hidden');
                document.getElementById('outputResultDiv').classList.remove('hidden');

                const suggestions = {
                    th: [
                        `<strong>1. ลดเวลาไซเคิล 20% (เหลือ ${(cycleTime * 0.8).toFixed(1)} วินาที):</strong><br>
                         - เวลาทำงานใหม่: ${(totalCycleTime / (cycleTime * 0.8) * cycleTime * 0.8 / 60).toFixed(1)} นาที<br>
                         - ชิ้นเพิ่ม: ${Math.floor((totalCycleTime / (cycleTime * 0.8)) / (1 + startupDefect + scrapRate)) - targetOutput} ชิ้น<br>
                         - ชิ้นทั้งหมดที่ทำได้: ${Math.floor((totalCycleTime / (cycleTime * 0.8)) / (1 + startupDefect + scrapRate))} ชิ้น`,
                        `<strong>2. ลดเวลาเตรียม 30% (เหลือ ${(setupTime / 60 * 0.7).toFixed(1)} นาที):</strong><br>
                         - เวลาเตรียมใหม่: ${(setupTime * 0.7 / 60).toFixed(1)} นาที<br>
                         - เวลาที่เพิ่ม: ${(setupTime * 0.3 / 60).toFixed(1)} นาที<br>
                         - ชิ้นเพิ่ม: ${Math.floor((setupTime * 0.3) / cycleTime / (1 + startupDefect + scrapRate))} ชิ้น<br>
                         - ชิ้นทั้งหมดที่ทำได้: ${Math.floor(((totalTime - setupTime * 0.7) / cycleTime) / (1 + startupDefect + scrapRate))} ชิ้น`,
                        `<strong>3. ลดของเสีย 50% (เหลือ ${(startupDefect * 50 + scrapRate * 50).toFixed(1)}${startupDefectUnit === 'percent' ? '%' : ' ชิ้น'}):</strong><br>
                         - ชิ้นที่ต้องทำใหม่: ${Math.ceil(totalParts / (1 + (startupDefectUnit === 'percent' ? startupDefect * 0.5 : startupDefect / totalParts) + (scrapRateUnit === 'percent' ? scrapRate * 0.5 : scrapRate / totalParts)))} ชิ้น<br>
                         - ชิ้นเพิ่ม: ${Math.floor(totalParts / (1 + (startupDefectUnit === 'percent' ? startupDefect * 0.5 : startupDefect / totalParts) + (scrapRateUnit === 'percent' ? scrapRate * 0.5 : scrapRate / totalParts))) - targetOutput} ชิ้น<br>
                         - ชิ้นทั้งหมดที่ทำได้: ${Math.floor(totalParts / (1 + (startupDefectUnit === 'percent' ? startupDefect * 0.5 : startupDefect / totalParts) + (scrapRateUnit === 'percent' ? scrapRate * 0.5 : scrapRate / totalParts)))} ชิ้น`
                    ],
                    en: [
                        `<strong>1. Reduce Cycle Time by 20% (to ${(cycleTime * 0.8).toFixed(1)} sec):</strong><br>
                         - New Production Time: ${(totalCycleTime / (cycleTime * 0.8) * cycleTime * 0.8 / 60).toFixed(1)} min<br>
                         - Extra Pieces: ${Math.floor((totalCycleTime / (cycleTime * 0.8)) / (1 + startupDefect + scrapRate)) - targetOutput} pcs<br>
                         - Total Pieces Possible: ${Math.floor((totalCycleTime / (cycleTime * 0.8)) / (1 + startupDefect + scrapRate))} pcs`,
                        `<strong>2. Reduce Setup Time by 30% (to ${(setupTime / 60 * 0.7).toFixed(1)} min):</strong><br>
                         - New Setup Time: ${(setupTime * 0.7 / 60).toFixed(1)} min<br>
                         - Extra Time Available: ${(setupTime * 0.3 / 60).toFixed(1)} min<br>
                         - Extra Pieces: ${Math.floor((setupTime * 0.3) / cycleTime / (1 + startupDefect + scrapRate))} pcs<br>
                         - Total Pieces Possible: ${Math.floor(((totalTime - setupTime * 0.7) / cycleTime) / (1 + startupDefect + scrapRate))} pcs`,
                        `<strong>3. Reduce Defects by 50% (to ${(startupDefect * 50 + scrapRate * 50).toFixed(1)}${startupDefectUnit === 'percent' ? '%' : ' pcs'}):</strong><br>
                         - New Total Pieces Needed: ${Math.ceil(totalParts / (1 + (startupDefectUnit === 'percent' ? startupDefect * 0.5 : startupDefect / totalParts) + (scrapRateUnit === 'percent' ? scrapRate * 0.5 : scrapRate / totalParts)))} pcs<br>
                         - Extra Pieces: ${Math.floor(totalParts / (1 + (startupDefectUnit === 'percent' ? startupDefect * 0.5 : startupDefect / totalParts) + (scrapRateUnit === 'percent' ? scrapRate * 0.5 : scrapRate / totalParts))) - targetOutput} pcs<br>
                         - Total Pieces Possible: ${Math.floor(totalParts / (1 + (startupDefectUnit === 'percent' ? startupDefect * 0.5 : startupDefect / totalParts) + (scrapRateUnit === 'percent' ? scrapRate * 0.5 : scrapRate / totalParts)))} pcs`
                    ]
                };
                document.getElementById('suggestions').innerHTML = suggestions[currentLang].map(s => `<p>${s}</p>`).join('');
            }

            document.getElementById('calculationSteps').innerHTML = calcSteps.map(step => `<p>${step}</p>`).join('');
            document.getElementById('results').classList.remove('hidden');
            updateStatus('done');
        }

        // Initialize select options on page load
        updateSelectOptions();
    </script>
</body>
</html>